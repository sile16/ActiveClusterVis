<!DOCTYPE html>
<html lang="en">
<head>
    
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>State Machine Interface</title>
<script src="network.js"></script>
<script src="fa.js"></script>
<script src="site.js"></script>
<script src="vmware.js"></script>
<script src="ac.js"></script>
<script src="cvis.js"></script>
<script src="https://unpkg.com/cytoscape@3.17.2/dist/cytoscape.min.js"></script>

<style>
    #output {
        margin-top: 20px;
        border: 1px solid #ccc;
        padding: 10px;
    }
    #cy {
        width: 100%;
        height: 600px;  /* Set a fixed height */
        position: relative;
    }
</style>
</head>
<body>

<h1>State Machine Interface</h1>

<button onclick="initializeSite()">Initialize Site</button>
<button onclick="step()">Step</button>
<br><br>

<label for="events">Select Event:</label>
<select id="events">
    <!-- Common events can remain hardcoded or be dynamically generated as well -->
    <option value="fail">Fail</option>
    <option value="recover">Recover</option>
    <option value="promote">Promote</option>
    <option value="power_on">Power On</option>
    <option value="power_off">Power Off</option>
    <option value="reboot">Reboot</option>
</select>
<br><br>


<label for="objects">Select Object:</label>
<select id="objects"></select>
<br><br>

<button onclick="handleObjectAction()">Handle Object Event</button>
<br><br>


<label for="connections">Select Connection:</label>
<select id="connections"></select>
<br><br>

<button onclick="handleConnectionAction()">Handle Connection Event</button>
<br><br>

<div id="cy"></div>

<script>
    let site;

    function initializeSite() {
        site = new MultiSite("Test Site");
        updateVisualization(site);  // Add this line
        populateObjectsDropdown();
        populateConnectionsDropdown();
        //do 1 step to initialize the site
        site.fullStep();
        updateVisualization(site);  // Add this line
        site.fullStep();
        updateVisualization(site);  // Add this line
        site.fullStep();
        updateVisualization(site);  // Add this line
        site.fullStep();
        updateVisualization(site);  // Add this line
        
        //console.log("site initialized");
        //updateOutput("Site Initialized");
    }

    function populateObjectsDropdown() {
        const objectsDropdown = document.getElementById('objects');
        objectsDropdown.innerHTML = '';  // Clear existing options

        // Assuming each site in MultiSite has an allObjects array

        for (let objectName in site.allObjects) {
            const option = document.createElement('option');
            option.value = objectName;  // Set value to object name
            option.text = objectName;  // Set text to object name
            objectsDropdown.add(option);
        }
    }

    function populateConnectionsDropdown() {
        const connectionsDropdown = document.getElementById('connections');
        connectionsDropdown.innerHTML = '';  // Clear existing options

        // Assuming globalAllConnections is globally accessible
        for (let connectionName in globalAllConnections) {
            const option = document.createElement('option');
            // Assuming each connection has a unique identifier property
            option.value = connectionName;  
            option.text = connectionName;  
            connectionsDropdown.add(option);
        }
    }

    function step() {
        site.fullStep();
        updateVisualization(site);  // Add this line
        //console.log("Step Executed");
    }

    function handleObjectAction() {
        const objectName = document.getElementById('objects').value;
        const eventName = document.getElementById('events').value;
        if(site.allObjects[objectName] && site.allObjects[objectName].handleAction) {
            site.allObjects[objectName].handleAction(eventName);
            console.log(`${objectName} handled event: ${eventName}`);
        } else {
            console.log('Invalid object or event');
        }
    }

    function handleConnectionAction() {
        const connectionName = document.getElementById('connections').value;
        const eventName = document.getElementById('events').value;
        if(globalAllConnections[connectionName] && globalAllConnections[connectionName].handleAction) {
            globalAllConnections[connectionName].handleAction(eventName);
            console.log(`${connectionName} handled event: ${eventName}`);
        } else {
            console.log('Invalid connection or event');
        }
    }

document.addEventListener('DOMContentLoaded', function() {
    initializeSite();
    
});

</script>

</body>
</html>
