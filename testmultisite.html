<!DOCTYPE html>
<html lang="en">
<head>
    
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>State Machine Interface</title>
<script src="network.js"></script>
<script src="fa.js"></script>
<script src="site.js"></script>
<script src="vmware.js"></script>
<script src="ac.js"></script>
<script src="cvis.js"></script>
<script src="https://unpkg.com/cytoscape@3.17.2/dist/cytoscape.min.js"></script>
<script src='https://unpkg.com/vanilla-jsoneditor/index.js'>    </script>



<style>
    #output {
        margin-top: 20px;
        border: 1px solid #ccc;
        padding: 10px;
    }
    #cy {
        width: 700px;
        height: 500px;  /* Set a fixed height */
        position: relative;
    }
    #logWindow {
        width: 100%;
        height: 150px;
        border: 1px solid #ccc;
        padding: 5px;
        box-sizing: border-box;
        overflow-y: auto;
        white-space: pre-wrap;
    }
</style>
</head>
<body>

    <h1>Active Cluster Simulator</h1>
    <p>Notes: Volume name and datstore name are alwyas the same. Please report any issues <a https://github.com/sile16/ActiveClusterVis/issues>here</a></p>
    <label for="wanlatency">WAN Latency RTT (ms):</label>
    <input oninput="site.setWANLatency(this.value)" type="text" id="wanlatency" name="wanlatency" value="3">


    <button onclick="site.addRepCrossover();step()">Add Replication Switch Crossover</button>
    <button onclick="site.addFCCrossover();step()">Add Uniform Connections</button>
    <button onclick="site.setPreferredArray();step()">Set Preferred Array in Host Entry</button>
    <button onclick="site.setPodFailoverPreference(document.getElementById('podfailover').value);step()">Set Pod Failover Preference</button>
    <select id="podfailover">
        <option value="none">None</option>
        <option value="site1fa1">site1fa1</option>
        <option value="site2fa1">site2fa1</option>
    </select>
    <button onclick="site.enableAPDPDL()">Enable VMWare APD/PDL</button>

    <br><br>
    

<label for="events">Mouse Click Event:</label>
<select id="events">
    <!-- Common events can remain hardcoded or be dynamically generated as well -->
    <option value="fail">Fail</option>
    <option value="recover">Recover</option>
    <option value="promote">Promote (FA Controllers Only)</option>
    <option value="power_on">Power On (VM Only)</option>
    <option value="power_off">Power Off (VM Only)</option>
    <option value="reboot">Reboot (VM Only)</option>
</select> add step after click <input type="checkbox" id="clickstep" name="step" value="step" checked>
<button onclick="step()">Step Forward In Time</button>
<br><br>

<div id="logWindow"></div>
<div id="cy"></div>
<p>VMS:</p>
<div id="vms_jsoneditor"></div>
<p>Pods:</p>
<div id="pods_jsoneditor"></div>
<p>Pod States:</p>
<div id="podstates_jsoneditor"></div>
<p>FlashArrays:</p>
<div id="fas_jsoneditor"></div>
<p>FA Host Entries:</p>
<div id="fahosts_jsoneditor"></div>
<p>VMHosts</p>
<div id="vmhosts_jsoneditor"></div>
<p>Datastore Paths</p>
<div id="vmhost_paths_jsoneditor"></div>

<script  type="module">
 import { JSONEditor } from 'https://unpkg.com/vanilla-jsoneditor/index.js'
        /*let content = {
            text: undefined,
            json: {
                greeting: 'Hello World' 
            }
        }*/

    let editors = {};
    for (let x of ['vms', 'pods', 'podstates', 'fas', 'fahosts', 'vmhosts', 'vmhost_paths']) {
        
        editors[x] = new JSONEditor({
            target: document.getElementById(x + '_jsoneditor'),
            props: {
                readOnly: true,
                fmainMenuBar: false,
                mode: "table",
                statusBar: false,
                navigationBar: false
            }
        });

        // example for single editor: window.fa_editorSet = (content) => fa_editor.set(content);
        // set a window variable to access all the editors using the x variable
        // Example for accessing the editor using the x variable
        // Store the editor in the editors object
        

        window[x + '_editorSet'] = (content) => editors[x].set(content);

    }

        
</script>

<script>
   
    let site;
    

    function log(message) {
        const logWindow = document.getElementById('logWindow');
        logWindow.innerHTML += message + '\n';
        logWindow.scrollTop = logWindow.scrollHeight;
    }

    function initializeSite() {

        

        site = new MultiSite("Test Site", document.getElementById('wanlatency').value);
        updateVisualization(site);  // Add this line
        //do 1 step to initialize the site
        step();
        step();
        step();
        step();
        
        //log("site initialized");
        //updateOutput("Site Initialized");
    }

    function step() {
        site.fullStep();
        updateVisualization(site);  // Add this line
        let currentjsonState = site.jsonStatus();
        //content.json = currentjsonState;  
         
        for (let x of ['vms', 'pods', 'podstates', 'fas', 'fahosts', 'vmhosts', 'vmhost_paths']) {
            if (window[x + '_editorSet']) {
               window[x + '_editorSet']({json: currentjsonState[x]});
            }
        }
        
        //log("Step Executed");
    }

    

document.addEventListener('DOMContentLoaded', function() {
    initializeSite();
    
});

</script>

</body>
</html>
